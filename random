package com.cts.employeeasset.userservice.service;

import com.cts.employeeasset.userservice.model.Employee;
import com.cts.employeeasset.userservice.repository.EmployeeRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Map;
import java.util.Optional;

@Service
@RequiredArgsConstructor
public class EmployeeService {

    private final EmployeeRepository repo;

    public Optional<Map<String, Object>> login(String empId, String email, String password) {

        if (empId != null) {
            try {
                Integer id = Integer.parseInt(empId);
                return repo.findById(id)
                        .filter(e -> e.getEmpPassword().equals(password))
                        .map(e -> Map.of(
                                "status", "OK",
                                "empId", e.getEmpId(),
                                "empName", e.getEmpName(),
                                "role", e.getRole()
                        ));
            } catch (Exception ignored) {}
        }

        if (email != null) {
            return repo.findByEmpEmail(email)
                    .filter(e -> e.getEmpPassword().equals(password))
                    .map(e -> Map.of(
                            "status", "OK",
                            "empId", e.getEmpId(),
                            "empName", e.getEmpName(),
                            "role", e.getRole()
                    ));
        }

        return Optional.empty();
    }

    public Optional<Employee> getEmployee(Integer id) {
        return repo.findById(id);
    }

    public List<Employee> searchByName(String name) {
        return repo.findByEmpNameContainingIgnoreCase(name);
    }
}
